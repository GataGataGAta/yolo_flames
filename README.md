以下のように、今日修正した内容（最初のperson検出フレームから開始する機能や、クリック後に次のフレームへ進むか選べるチェックボックス追加など）を反映したREADMEの修正版を作成しました。

---

````markdown
# YOLOv8 クリックアノテーションツール

このツールは、YOLOv8オブジェクト検出を利用して、動画のフレーム内のオブジェクトにアノテーションを付けるためのGUIツールです。  
動画からフレームを抽出し、最初に`person`クラスが検出されたフレームからアノテーションを開始できます。また、クリック後に自動的に次のフレームへ進むかどうかをGUI上のチェックボックスで切り替え可能です。

---

## 必要なもの

* Python 3.6以上
* 必要なPythonパッケージ：
  * opencv-python
  * imageio
  * ultralytics
  * Pillow
  * tkinter (通常Pythonに付属していますが、システムによっては別途インストールが必要な場合があります)
  * tqdm

以下のコマンドでインストール可能です：

```bash
pip install opencv-python imageio ultralytics Pillow tqdm
````

---

## インストール

1. スクリプト `yolo_click.py` をダウンロードします。

---

## 使い方

1. **スクリプトを実行：**

   ```bash
   python yolo_click.py demo.mp4
   ```

   `demo.mp4` は対象の動画ファイルのパスに置き換えてください。

2. **フレームの抽出：**

   * `<video_name>_frames` ディレクトリにフレーム画像が存在しなければ動画から抽出されます。
   * 抽出済みの場合はスキップされます。

3. **アノテーション開始位置の自動検出：**

   * ツールは最初に`person`クラスを検出したフレームからアノテーションを開始します。
   * ただし、途中で中断して再開した場合は、保存されている進捗 (`progress.json`) の位置から開始します。

4. **GUIの操作：**

   * 左側にクラスID選択用のコンボボックスがあります。アノテーションしたいクラスIDを選択してください。
   * クラスID選択欄の下に「クリック後に次のフレームへ進む」チェックボックスがあり、オン/オフでクリック後の自動進行を切り替えられます。
   * 画像上の検出オブジェクトをクリックすると、そのオブジェクトに対してアノテーションが保存されます。
   * 自動進行がオンの場合はクリック後に次のフレームに移動し、オフの場合は現在のフレームのままです。

5. **キーボードショートカット：**

   * `f` : 次のフレームへ
   * `d` : 前のフレームへ
   * `s` : 現在のクリック位置のラベルを保存
   * `q` : 進捗を保存して終了
   * `w` : 進捗をリセット（`progress.json`を削除）して終了

---

## 出力

* アノテーション画像と対応YOLO形式ラベルは以下のディレクトリに保存されます。
  `output_dataset/images/train`, `output_dataset/images/val`
  `output_dataset/labels/train`, `output_dataset/labels/val`
  ※10回に1回の割合で `val` に振り分けられます。

* クリック時の赤いバウンディングボックス付き画像は `output_clicked` に保存されます。

* アノテーションの進捗情報は `progress.json` に保存され、途中からの再開が可能です。

---

## ディレクトリ構造

```
output_dataset/
├── images/
│   ├── train/
│   ├── val/
├── labels/
│   ├── train/
│   ├── val/
output_clicked/
video_name_frames/
progress.json
```

---

## 設定項目

* `CLASS_NAMES`
  YOLOv8モデル (`yolov8n.pt` など) から自動取得されます。

* `BASE_DIR`
  アノテーション出力ベースディレクトリ（デフォルト：`output_dataset`）。

* `CLICKED_OUTPUT_DIR`
  クリック画像保存先（デフォルト：`output_clicked`）。

* `PROGRESS_FILE`
  進捗保存ファイル（デフォルト：`progress.json`）。

---

## ヒント

* フレーム数が多い場合は抽出時にFPSを調整し、アノテーション対象を減らすと効率的です。
* 定期的に `q` キーで進捗を保存して作業を安全に中断しましょう。
* 「クリック後に次のフレームへ進む」チェックをOFFにすると、じっくり1フレームずつアノテーション可能です。

---

## トラブルシューティング

* フレーム抽出に失敗する場合は、必要な動画コーデックがインストールされているか確認してください。
* GUI表示が崩れる場合は、PythonのTkinter環境が正常か確認してください。

---

## クレジット

本ツールは、Ultralytics社のYOLOv8オブジェクト検出フレームワークをベースに作成されています。

```