```markdown
# YOLOv8 クリックアノテーションツール

このツールは、YOLOv8オブジェクト検出を利用して動画フレーム内のオブジェクトにアノテーションを付けるためのものです。フレームの移動、オブジェクトクラスの選択、YOLO形式でのアノテーションの保存といった機能を、簡単なGUIを通じて提供します。

## 必要なもの

* Python 3.6以上
* 必要なPythonパッケージ：
    * `opencv-python`
    * `imageio`
    * `ultralytics`
    * `Pillow`
    * `tkinter` (通常はPythonに付属)
    * `tqdm`

これらのパッケージは、pipを使用してインストールできます。

```bash
pip install opencv-python imageio ultralytics Pillow tqdm
```

## インストール

1.  スクリプト `yolo_click.py` をダウンロードします。

## 使い方

1.  **スクリプトを実行します：**

    ```bash
    python yolo_click.py demo.mp4
    ```

    `demo.mp4` を実際の動画ファイルパスに置き換えてください。

2.  **フレームの抽出：**

    *   `<video_name>_frames` ディレクトリにフレーム画像が存在しない場合、ツールは動画からフレームを抽出します。
    *   ディレクトリにフレーム画像が既に存在する場合、抽出はスキップされます。

3.  **アノテーション開始位置：**

    *   初回実行時は、動画内で最初に `person` クラスを検出したフレームからアノテーションを開始します。
    *   中断して再開するときは、保存されている進捗（`動画名_progress.json`）の位置から開始します。

4.  **アノテーションのプロセス：**

    *   GUIウィンドウが表示され、最初のフレームがYOLOv8オブジェクト検出の結果とともに表示されます。
    *   左側にクラスID選択用のコンボボックスがあり、アノテーションしたいクラスIDを選択します。
    *   画像内の検出オブジェクトをクリックすると、対応するYOLO形式のアノテーションと画像が保存されます。
    *   クリックすると、自動的に次のフレームへ移動します。

5.  **キーボードショートカット：**

    *   `f` : 次のフレーム
    *   `d` : 前のフレーム
    *   `q` : 進捗を保存して終了
    *   `w` : 進捗をリセット（`動画名_progress.json` を削除）して終了

## 出力：

*   アノテーション済みの画像とYOLO形式のラベルファイルは、`output_dataset` ディレクトリに保存され、`train` および `val` サブディレクトリに分割されます。
*   バウンディングボックス付きのクリックされた画像は、`output_clicked` ディレクトリに保存されます。
*   進捗情報は `progress_files/動画名_progress.json` に保存され、後から作業を再開できます。

## ディレクトリ構造

ツールは以下のディレクトリ構造を作成します。

```
output_dataset/
├── images/
│   ├── train/
│   └── val/
├── labels/
│   ├── train/
│   └── val/
output_clicked/
video_name_frames/
progress_files/
└── 動画名_progress.json
```

## 設定

*   `CLASS_NAMES`: YOLOv8モデル（デフォルトは `yolov8n.pt`）から自動取得されます。
*   `BASE_DIR`: 出力データセットのベースディレクトリ（デフォルト：`output_dataset`）。
*   `CLICKED_OUTPUT_DIR`: クリックされた画像の保存ディレクトリ（デフォルト：`output_clicked`）。
*   `PROGRESS_DIR`: 進捗ファイルを保存するディレクトリ（デフォルト：`progress_files`）。

## ヒント

*   アノテーション開始位置は、最初に `person` が検出されたフレームからスタートするため、効率的な作業が可能です。
*   定期的に `q` キーで進捗を保存しながら作業を進めてください。

## トラブルシューティング

*   フレーム抽出に失敗した場合は、動画のコーデックが適切か確認してください。
*   GUIが正常に表示されない場合は、PythonのTkinter環境を確認してください。

## クレジット

このツールは、UltralyticsによるYOLOv8オブジェクト検出フレームワークに基づいています。
```