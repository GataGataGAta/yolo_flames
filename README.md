```markdown
# YOLOv8 クリックアノテーションツール

このツールは、YOLOv8オブジェクト検出を利用して、動画のフレーム内のオブジェクトにアノテーションを付けるためのものです。 フレームの移動、オブジェクトクラスの選択、YOLO形式でのアノテーションの保存を行うための簡単なGUIを提供します。

## 必要なもの

*   Python 3.6以上
*   必要なPythonパッケージ：
    *   opencv-python
    *   imageio
    *   ultralytics
    *   Pillow
    *   tkinter (通常はPythonに付属していますが、システムによっては別途インストールが必要な場合があります)
    *   tqdm

これらのパッケージは、pipを使用してインストールできます。

```bash
pip install opencv-python imageio ultralytics Pillow tqdm
```

## インストール

1.  スクリプト `yolo_click.py` をダウンロードします。

## 使い方

1.  **スクリプトを実行します：**

    ```bash
    python yolo_click.py demo.mp4
    ```

    `demo.mp4` を、実際の動画ファイルのパスに置き換えてください。

2.  **フレームの抽出：**

    *   `<video_name>_frames` ディレクトリにフレーム画像が存在しない場合、ツールはフレームレート（60fpsまたは30fps）を選択するように求めます。 `1` または `2` を入力してフレームレートを選択してください。
    *   ツールは動画からフレームを抽出し、`<video_name>_frames` ディレクトリに保存します。
    *   ディレクトリにフレーム画像が既に存在する場合、ツールはフレーム抽出をスキップしてアノテーションに進みます。

3.  **アノテーションのプロセス：**

    *   GUIウィンドウが表示され、最初のフレームがYOLOv8オブジェクト検出の結果とともに表示されます。
    *   クラスIDの選択パネルが左側にあります。 コンボボックスを使用して、アノテーションを付けるオブジェクトのクラスIDを選択します。
    *   画像内のオブジェクトをクリックしてアノテーションを付けます。 ツールは次の処理を行います。
        *   画像を `output_dataset/images/train` または `output_dataset/images/val` ディレクトリに保存します。
        *   対応するYOLO形式のラベルファイルを `output_dataset/labels/train` または `output_dataset/labels/val` ディレクトリに作成します。
        *   クリックした画像のコピーを、赤いバウンディングボックス付きで `output_clicked` ディレクトリに保存します。
        *   自動的に次のフレームに進みます。
    *   次のキーを使用して、アノテーションプロセスをナビゲートおよび制御します。
        *   `f`: 次のフレーム
        *   `d`: 前のフレーム
        *   `s`: クリックしたオブジェクトのラベルを保存
        *   `q`: 進捗を保存して終了
        *   `w`: 進捗をリセット（`progress.json` を削除）して終了

4.  **出力：**

    *   アノテーション付きの画像とYOLO形式のラベルファイルは、`output_dataset` ディレクトリに保存され、`train` および `val` サブディレクトリに分割されます。
    *   バウンディングボックス付きのクリックされた画像は、`output_clicked` ディレクトリに保存されます。
    *   現在の進捗状況（最後にアノテーションを付けたフレームとクリック数）は、`progress.json` ファイルに保存され、後でアノテーションを再開できます。

## ディレクトリ構造

ツールは次のディレクトリ構造を作成します。

```
output_dataset/
├── images/
│   ├── train/
│   │   └── 000001.jpg
│   ├── val/
│   │   └── 000010.jpg
├── labels/
│   ├── train/
│   │   └── 000001.txt
│   ├── val/
│   │   └── 000010.txt
output_clicked/
│   └── 000001.jpg
video_name_frames/
│   └── 00000001.jpg
progress.json
```

## 設定

*   `CLASS_NAMES`: クラス名は、YOLOv8モデル（デフォルトでは `yolov8n.pt` ）から自動的にロードされます。 スクリプトでモデルを変更できます。
*   `BASE_DIR`: 出力データセットのベースディレクトリ（デフォルト：`output_dataset`）。
*   `CLICKED_OUTPUT_DIR`: クリックされた画像のディレクトリ（デフォルト：`output_clicked`）。
*   `PROGRESS_FILE`: 進捗状況を保存するためのファイル（デフォルト：`progress.json`）。

## ヒント

*   アノテーションするフレームの数を減らすために、低いフレームレートから開始してください。
*   キーボードショートカットを使用して、アノテーションプロセスをスピードアップしてください。
*   データが失われるのを防ぐために、`q`を押して定期的に進捗状況を保存してください。

## トラブルシューティング

*   フレーム抽出中にエラーが発生した場合は、必要なコーデックがインストールされていることを確認してください。
*   GUIが正しく表示されない場合は、正しいバージョンのTkinterがインストールされているかどうかを確認してください。

## クレジット

このツールは、UltralyticsによるYOLOv8オブジェクト検出フレームワークに基づいています。
```